#!/usr/bin/env bash
set -euo pipefail

# Only validate if .cook files are staged
if git diff --cached --name-only | grep -q '\.cook$\|aisle\.conf$'; then
    echo "Recipe files changed, validating..."

    if ! command -v cook &> /dev/null; then
        echo "Error: cook CLI not found. Install with: brew install cooklang/tap/cook"
        exit 1
    fi

    # Run validation
    if ! cook doctor validate 2>&1; then
        echo "Recipe validation failed. Fix errors before committing."
        exit 1
    fi
fi
